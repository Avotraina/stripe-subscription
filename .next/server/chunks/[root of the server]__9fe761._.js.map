{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["file:///home/avotraina/projetcts/bun/blog-generator/app/api/webhooks/stripe/route.ts"],"sourcesContent":["import { get, patch } from \"@/app/lib/server\";\nimport { findUserFromCustomerId } from \"@/app/services/users\";\nimport { getSession } from \"next-auth/react\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\n\nexport const POST = async (req: NextRequest) => {\n    const body = (await req.json()) as Stripe.Event;\n\n    switch (body.type) {\n        case \"checkout.session.completed\":\n            const checkoutSession = body.data.object as Stripe.Checkout.Session;\n            // Handle successful payment\n            const stripeCustomerId = checkoutSession.customer;\n            console.log(\"SESSION COMPLETED\", stripeCustomerId)\n            const authSession = await getSession();\n            console.log(\"USER SESSION\", authSession)\n\n            const user = await findUserFromCustomerId(stripeCustomerId);\n            // const user = await get(`/api/user?id=${authSession?.user.keyCloakUserId}`)\n            // const response = await patch(`/api/user?id=${user?.id}`, {\n            //     stripeCustomerId: stripeCustomerId\n            // })\n\n            // if (!user) {\n\n            //     const authSession = await getSession();\n            //     const response = await get(`/api/user?id=${authSession?.}`, {\n            //         stripeCustomerId: stripeCustomerId\n            //     })\n            // }\n            \n            break;\n\n        case \"payment_intent.succeeded\":\n            const paymentIntent = body.data.object as Stripe.PaymentIntent;\n            // Handle successful payment intent\n            break;\n\n        case \"payment_intent.payment_failed\":\n            const failedPaymentIntent = body.data.object as Stripe.PaymentIntent;\n            // Handle failed payment\n            break;\n\n        case \"customer.subscription.created\":\n            const subscriptionCreated = body.data.object as Stripe.Subscription;\n            // Handle new subscription\n            break;\n\n        case \"customer.subscription.updated\":\n            const subscriptionUpdated = body.data.object as Stripe.Subscription;\n            // Handle subscription update\n            console.log(\"SUBSCRIPTION UPDATE\")\n\n            break;\n\n        case \"customer.subscription.deleted\":\n            const subscriptionDeleted = body.data.object as Stripe.Subscription;\n            // Handle subscription cancellation\n            break;\n\n        case \"invoice.paid\":\n            const paidInvoice = body.data.object as Stripe.Invoice;\n            // Handle paid invoice\n            console.log(\"INVOICE PAID\")\n\n            break;\n\n        case \"invoice.payment_succeeded\":\n            const paymentSucceed = body.data.object as Stripe.Invoice;\n            // Handle paid invoice\n            console.log(\"INVOICE PAID\")\n\n            break;\n\n        case \"invoice.payment_failed\":\n            const failedInvoice = body.data.object as Stripe.Invoice;\n            // Handle failed invoice payment\n            break;\n\n        default:\n            console.log(`Unhandled event type: ${body.type}`);\n            break;\n        // case value:\n\n        //     break;\n\n        // default:\n        //     break;\n    }\n    return NextResponse.json({})\n\n}\n"],"names":[],"mappings":";;;AACA;AACA;AACA;;;;AAGO,MAAM,OAAO,OAAO;IACvB,MAAM,OAAQ,MAAM,IAAI,IAAI;IAE5B,OAAQ,KAAK,IAAI;QACb,KAAK;YACD,MAAM,kBAAkB,KAAK,IAAI,CAAC,MAAM;YACxC,4BAA4B;YAC5B,MAAM,mBAAmB,gBAAgB,QAAQ;YACjD,QAAQ,GAAG,CAAC,qBAAqB;YACjC,MAAM,cAAc,MAAM,CAAA,GAAA,gJAAA,CAAA,aAAU,AAAD;YACnC,QAAQ,GAAG,CAAC,gBAAgB;YAE5B,MAAM,OAAO,MAAM,CAAA,GAAA,0HAAA,CAAA,yBAAsB,AAAD,EAAE;YAc1C;QAEJ,KAAK;YACD,MAAM,gBAAgB,KAAK,IAAI,CAAC,MAAM;YAEtC;QAEJ,KAAK;YACD,MAAM,sBAAsB,KAAK,IAAI,CAAC,MAAM;YAE5C;QAEJ,KAAK;YACD,MAAM,sBAAsB,KAAK,IAAI,CAAC,MAAM;YAE5C;QAEJ,KAAK;YACD,MAAM,sBAAsB,KAAK,IAAI,CAAC,MAAM;YAC5C,6BAA6B;YAC7B,QAAQ,GAAG,CAAC;YAEZ;QAEJ,KAAK;YACD,MAAM,sBAAsB,KAAK,IAAI,CAAC,MAAM;YAE5C;QAEJ,KAAK;YACD,MAAM,cAAc,KAAK,IAAI,CAAC,MAAM;YACpC,sBAAsB;YACtB,QAAQ,GAAG,CAAC;YAEZ;QAEJ,KAAK;YACD,MAAM,iBAAiB,KAAK,IAAI,CAAC,MAAM;YACvC,sBAAsB;YACtB,QAAQ,GAAG,CAAC;YAEZ;QAEJ,KAAK;YACD,MAAM,gBAAgB,KAAK,IAAI,CAAC,MAAM;YAEtC;QAEJ;YACI,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,KAAK,IAAI,EAAE;YAChD;IAOR;IACA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,CAAC;AAE9B"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}